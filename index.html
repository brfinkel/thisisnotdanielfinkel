<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daniel Finkel | Stegner Fellow at Stanford, Writer</title>
  
  <!-- Preload critical resources: Fonts and the grain texture -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet" />
  <link rel="preload" href="https://grainy-gradients.vercel.app/noise.png" as="image" />
  
  <!-- SEO Meta Tags for discoverability and rich snippets -->
  <meta name="description" content="Official website of Daniel Finkel, a 2025-27 Wallace Stegner Fellow in Fiction at Stanford University and writer from Philadelphia. Currently working on a novel." />
  <meta name="keywords" content="Daniel Finkel, Daniel Finkel writer, Daniel Finkel Stegner, Daniel Finkel Stanford, Wallace Stegner Fellow, Stanford University, novelist, The Penn Review, Philadelphia writer" />
  
  <!-- Open Graph / Social Media Meta Tags for better sharing previews -->
  <meta property="og:title" content="Daniel Finkel | Stegner Fellow at Stanford, Writer" />
  <meta property="og:description" content="Official website of Daniel Finkel, a 2025-27 Wallace Stegner Fellow in Fiction at Stanford University and writer from Philadelphia. Currently working on a novel." />
  <meta property="og:type" content="profile" />
  <meta property="og:url" content="https://dsfinkel.com/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Daniel Finkel | Stegner Fellow at Stanford, Writer" />
  <meta name="twitter:description" content="Official website of Daniel Finkel, a 2025-27 Wallace Stegner Fellow in Fiction at Stanford University and writer from Philadelphia. Currently working on a novel." />
  
  <!-- Structured Data (Schema.org) for enhanced search results -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Daniel Finkel",
    "url": "https://dsfinkel.com/",
    "givenName": "Daniel",
    "familyName": "Finkel",
    "alumniOf": [
      {
        "@type": "EducationalOrganization",
        "name": "Stanford University",
        "sameAs": "https://www.stanford.edu/"
      },
      {
        "@type": "EducationalOrganization",
        "name": "University of Pennsylvania",
        "sameAs": "https://www.upenn.edu/"
      }
    ],
    "hasOccupation": {
      "@type": "Occupation",
      "name": "Writer"
    },
    "knowsAbout": ["Fiction Writing", "Novel Writing", "Literary Arts", "Wallace Stegner Fellowship"],
    "award": "Wallace Stegner Fellowship",
    "memberOf": {
      "@type": "Organization",
      "name": "Wallace Stegner Fellowship Program",
      "sameAs": "https://creativewriting.stanford.edu/stegner-fellowship"
    },
    "sameAs": [
      "mailto:danielsf@stanford.edu",
      "https://instagram.com/d.s.finkel",
      "https://creativewriting.stanford.edu/stegner-fellowship/current-fellows"
    ]
  }
  </script>

  <style>
    /* CSS Custom Properties for maintainability and easy theming */
    :root {
      --primary-gradient: linear-gradient(270deg, #333, #ccc, #333); /* Soft grayscale gradient for text */
      --background-gradient: radial-gradient(circle at center, #fbc2eb, #a6c1ee, #ffd6d6, #e0c3fc); /* User-specified background gradient */
      --animation-duration-fast: 15s;
      --animation-duration-slow: 40s;
      --text-color: #333; /* Softer dark grey for general text */
      --link-hover-color-default: #6c63ff; /* Original link hover color as a default */
      --current-link-hover-color: var(--link-hover-color-default); /* Dynamic variable for link hover color */
      --font-serif: 'Fraunces', serif;
      --font-sans: 'Inter', sans-serif; /* Modern sans-serif font for secondary text */
    }

    /* Universal reset for margin and padding */
    *, *::before, *::after {
        box-sizing: border-box;
    }

    /* Base styles for HTML and Body: Full viewport, flexbox centering, custom cursor */
    html, body {
      margin: 0;
      height: 100%;
      font-family: var(--font-serif); /* Default font for main content */
      display: flex; /* Flexbox for centering main content */
      justify-content: center;
      align-items: center;
      background: var(--background-gradient);
      background-size: 500% 500%; /* Enables background animation */
      background-attachment: fixed; /* Keeps background fixed during any scroll */
      animation: gradientShift var(--animation-duration-slow) ease infinite; /* Animates background position */
      overflow: hidden; /* Crucial to prevent native scrollbars for custom scroll effect */
      min-height: 100vh;
      min-width: 100vw;
      position: relative;
      cursor: none !important; /* Force hides native cursor across the entire page */
    }

    /* Force hide native cursor for all anchor links */
    a {
      cursor: none !important;
    }

    /* Custom cursor styles: Fixed position, small dot, smooth transitions */
    .custom-cursor {
      position: fixed;
      /* Left and top are now directly controlled by JavaScript for precise positioning */
      left: 0;
      top: 0;
      width: 12px; /* Increased size for better visibility as a "ball" */
      height: 12px; /* Increased size for better visibility as a "ball" */
      background-color: rgba(0, 0, 0, 0.5); /* Default semi-transparent black */
      border-radius: 50%; /* Makes it a perfect circle */
      pointer-events: none; /* Allows mouse events to pass through to elements beneath */
      z-index: 9999; /* Ensures it's always on top */
      transition: background-color 0.2s ease-out, opacity 0.2s ease-out; /* Smooth color and opacity changes */
      will-change: left, top, background-color, opacity; /* Performance hint for browser */
    }

    /* Keyframe animation for the background gradient shift */
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Keyframe animation for initial text settling effect */
    @keyframes textSettle {
      0% {
        transform: scale(1.05);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Keyframe animation for the subtle grain overlay movement */
    @keyframes grainAnimation {
      0%, 100% { background-position: 0 0; }
      10% { background-position: 1px 1px; }
      20% { background-position: -1px -1px; }
      30% { background-position: 1px 0; }
      40% { background-position: -1px 1px; }
      50% { background-position: 0 -1px; }
      60% { background-position: 1px -1px; }
      70% { background-position: -1px 0; }
      80% { background-position: 0 1px; }
      90% { background-position: -1px -1px; }
    }

    /* Main typography styles for the h1 element */
    h1 {
      font-size: clamp(1.1rem, 3.5vw, 2.2rem); /* Responsive font size */
      font-weight: 400;
      width: clamp(80vw, 85vw, 1000px); /* Responsive width with max constraint */
      max-width: 1000px;
      line-height: 1.6; /* Generous line height for readability */
      text-align: left;
      /* Removed background-clip, -webkit-background-clip, -webkit-text-fill-color, mix-blend-mode */
      color: var(--text-color); /* Set explicit color for h1 text to ensure visibility */
      animation: textSettle 1.5s ease-out forwards; /* Only textSettle animation remains */
      word-break: break-word; /* Prevents long words from overflowing */
      overflow-wrap: break-word; /* Handles word wrapping */
      margin: 0; /* Important for correct flex centering */
      font-family: var(--font-serif);
      z-index: 5;
      position: relative; /* Necessary for z-index and positioning of child elements like underlines */
      cursor: none !important; /* Force hide native cursor on h1 */
      /* Prevents text selection */
      -webkit-user-select: none; 
      -moz-user-select: none; 
      -ms-user-select: none; 
      user-select: none; 
      will-change: transform; /* Performance hint for the scroll budging animation */
    }

    /* Disable hover transform on h1 as it's not part of the lovefrom.com aesthetic */
    h1:hover {
      transform: none; 
    }

    /* Ensures span elements within h1 create line breaks */
    .line-break-span {
      display: block;
    }

    /* Common styles for italic and Stegner links */
    .body-italic,
    .stegner-link {
      position: relative;
      color: var(--text-color); /* Explicitly set color for visible text */
      text-decoration: none; /* No default underline */
      cursor: default; /* Overridden by global cursor: none */
      transition: color 0.3s ease; /* Smooth color change on hover */
    }

    /* Subtle hover color for links - now uses the dynamically set CSS variable */
    .body-italic:hover,
    .stegner-link:hover {
      color: var(--current-link-hover-color); 
    }

    /* Explicitly make body italic elements italic */
    .body-italic {
      font-style: italic;
    }

    /* Shared underline base styles for links (Original behavior tied to h1 hover) */
    .body-italic::after,
    .stegner-link::after {
      content: '';
      position: absolute;
      bottom: -2px; /* Position beneath the text */
      left: 0;
      width: 0%; /* Initially hidden */
      height: 2px;
      background: var(--primary-gradient); /* Underline uses the text gradient */
      background-size: 400% 400%;
      background-position: 0% 50%;
      animation: gradientShift var(--animation-duration-fast) ease infinite;
      opacity: 0.5; /* Semi-transparent underline */
      transition: width 0.6s ease; /* Smooth transition for width change */
    }

    /* Underline appears when the entire h1 is hovered */
    h1:hover .body-italic::after {
      width: 100%;
      transition-delay: 0.125s; /* Small delay for staggered effect */
    }

    /* Underline appears when the entire h1 is hovered (no delay for stegner link) */
    h1:hover .stegner-link::after {
      width: 100%;
      transition-delay: 0s;
    }

    /* Underline retracts when the h1 is no longer hovered */
    h1:not(:hover) .body-italic::after,
    h1:not(:hover) .stegner-link::after { 
      width: 0%;
      transition-delay: 0.125s; /* Small delay on retract for consistent feel */
    }

    /* Grain texture overlay: Covers the entire screen, provides subtle visual noise */
    .grain {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; /* Allows clicks and interactions to pass through */
      background-image: url('https://grainy-gradients.vercel.app/noise.png');
      background-size: 100px; /* Scales the noise image */
      opacity: 0.5; /* Reduced opacity for subtlety */
      filter: none; /* No strong filters for natural look */
      z-index: 20; /* Ensures it's above background but below main content */
      mix-blend-mode: overlay; /* Soft blend with content below */
      animation: grainAnimation 1s linear infinite; /* Animates the grain for a live effect */
    }

    /* Contact information block: Fixed position, discreet styling */
    .contact-text {
      position: fixed;
      right: 18px;
      bottom: 12px;
      font-size: 0.75rem; /* Slightly smaller for discreteness */
      color: #666; /* Softer text color */
      z-index: 30; /* Ensures it's above other elements */
      opacity: 0.8; /* Slightly opaque for a subtle presence */
      display: flex;
      flex-direction: row;
      align-items: center;
      font-family: var(--font-sans); /* Uses the sans-serif font */
      pointer-events: auto; /* Allows interaction with contact links */
      user-select: text; /* Allows text selection for copying contact info */
      gap: 16px; /* Spacing between links */
    }

    /* Styles for individual contact links, with hover effects */
    .contact-text a {
      color: #666; /* Inherits softer color */
      text-decoration: none;
      font-size: 0.75rem; /* Consistent font size */
      /* Smooth transitions for color, transform, and opacity */
      transition: color 0.3s ease, transform 0.2s ease-out, opacity 0.2s ease-out;
      opacity: 0.85; /* Default opacity */
      font-family: var(--font-sans);
      position: relative;
      display: inline-block; /* Required for transform to work correctly on inline elements */
      /* New: Larger clickable area using padding */
      padding: 5px 8px; /* Adds padding to increase hover area */
      margin: -5px -8px; /* Negative margin to offset padding and maintain original visual position */
    }

    /* Hover effect for contact links: lift, scale, and full opacity */
    .contact-text a:hover {
      color: var(--current-link-hover-color); /* Now uses dynamic color */
      transform: translateY(-3px) scale(1.1); /* Lifts up and scales slightly */
      opacity: 1; /* Becomes fully opaque */
    }

    /* Responsive adjustments for smaller screens */
    @media (max-width: 700px) {
      h1 {
        font-size: clamp(1rem, 4.5vw, 1.4rem);
        width: clamp(90vw, 95vw, 97vw);
        max-width: 98vw;
        padding: 0 2vw;
      }
      
      .contact-text {
        font-size: 0.65rem; 
        bottom: 8px;
        right: 8px;
        gap: 8px; 
      }
      
      .contact-text a {
        font-size: 0.65rem;
      }
    }

    /* Accessibility: Disable animations for users preferring reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        transition-property: all !important; /* Apply to all transitionable properties */
        transition-delay: 0s !important; /* No delay */
      }
    }
  </style>
</head>

<body>
  <h1>
    <span class="line-break-span">Daniel Finkel is a writer from Philadelphia.</span>
    A 2025-27 <a href="https://creativewriting.stanford.edu/stegner-fellowship/meet-stegner-fellows" target="_blank" rel="noopener" class="stegner-link">Stegner Fellow</a> at Stanford and former editor-in-chief of
    <a href="https://www.pennreview.org/" target="_blank" rel="noopener" class="body-italic">The Penn Review</a>, he is currently working on a novel about undercover <span>spies</span> in a union election.
  </h1>
  
  <div class="grain"></div>
  <div class="custom-cursor"></div> <!-- Custom dot cursor element -->
  
  <div class="contact-text">
    <a href="mailto:danielsf@stanford.edu">email</a>
    <a href="https://instagram.com/d.s.finkel" target="_blank" rel="noopener">instagram</a>
  </div>

  <script>
    (function() {
      'use strict';
      
      const customCursor = document.querySelector('.custom-cursor');
      let animationId; // Single requestAnimationFrame ID for the main animation loop

      let scrollOffset = 0; 
      let targetScrollOffset = 0; 
      const scrollAmplitude = 80; 
      const scrollSensitivity = 0.6; 
      const scrollDamping = 0.08; 
      const scrollSpring = 0.5; 
      let rAFScroll; // RequestAnimationFrame ID for the scroll effect

      const primaryColors = [
        'hsl(0, 80%, 55%)',    // Vibrant Red
        'hsl(200, 100%, 40%)', // Intense Blue
        'hsl(45, 80%, 50%)',  // Richer Golden Yellow
        'hsl(140, 70%, 45%)'   // Lively Green
      ];
      let currentColorIndex = 0; 

      // Screensaver variables
      let isMouseOutsideWindow = false; // Flag to indicate if mouse/touch is inactive (screensaver mode)
      let cursorX = window.innerWidth / 2; // Current X position of the dot's top-left
      let cursorY = window.innerHeight / 2; // Current Y position of the dot's top-left
      let cursorVx = 0; // X velocity (pixels per frame)
      let cursorVy = 0; // Y velocity (pixels per frame)
      let cursorSize = 0; // Size of the cursor dot, initialized on DOMContentLoaded
      
      let lastClientX = cursorX; // Last recorded mouse/touch X, for velocity calculation
      let lastClientY = cursorY; // Last recorded mouse/touch Y, for velocity calculation

      // New: Damping factor for screensaver bounce
      const screensaverDamping = 0.7; // Decreased value for more damping, making it feel heavier

      // Inactivity timer for screensaver activation
      let inactivityTimeoutId = null;
      const INACTIVITY_DELAY_MS = 3000; // 3 seconds of inactivity before screensaver activates

      // --- Screensaver & Inactivity Management ---
      function startInactivityTimer() {
        clearTimeout(inactivityTimeoutId); // Clear any existing timer
        inactivityTimeoutId = setTimeout(activateScreensaver, INACTIVITY_DELAY_MS);
      }

      function clearInactivityTimer(e) {
        clearTimeout(inactivityTimeoutId);
        inactivityTimeoutId = null;
        deactivateScreensaver(e); // Immediately deactivate screensaver if active
      }

      function activateScreensaver() {
        if (!isMouseOutsideWindow) { // Only activate if not already active
          isMouseOutsideWindow = true;
          customCursor.style.opacity = '1'; // Make the ball fully opaque in screensaver mode
          // Ensure velocity is set for initial movement
          const minInitialSpeed = 2;
          const maxDesiredSpeed = 5;
          const currentSpeed = Math.sqrt(cursorVx * cursorVx + cursorVy * cursorVy);

          if (currentSpeed < minInitialSpeed) {
            cursorVx = (Math.random() > 0.5 ? 1 : -1) * (minInitialSpeed + Math.random() * 3);
            cursorVy = (Math.random() > 0.5 ? 1 : -1) * (minInitialSpeed + Math.random() * 3);
          } else if (currentSpeed > maxDesiredSpeed) {
            const scaleFactor = maxDesiredSpeed / currentSpeed;
            cursorVx *= scaleFactor;
            cursorVy *= scaleFactor;
          }
          console.log('Screensaver: Activated.');
        }
      }

      function deactivateScreensaver(e) {
        if (isMouseOutsideWindow) { // Only deactivate if currently active
          isMouseOutsideWindow = false;
          customCursor.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'; // Reset cursor color to default
          customCursor.style.opacity = '0.5'; // Reset cursor opacity to default for non-hover state

          // Snap cursor to event position if available (mouse or touch), otherwise last known.
          if (e && (e.clientX !== undefined || (e.touches && e.touches[0] && e.touches[0].clientX !== undefined))) {
            const clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;
            const clientY = e.clientY !== undefined ? e.clientY : e.touches[0].clientY;
            cursorX = clientX - (cursorSize / 2);
            cursorY = clientY - (cursorSize / 2);
            lastClientX = clientX; // Also update lastClientX/Y for correct velocity calculation later
            lastClientY = clientY;
          }
          console.log('Screensaver: Deactivated.');
        }
      }

      // --- Main Animation Loop ---
      // This single loop handles both mouse-following/touch-following and screensaver bouncing.
      function mainAnimationLoop() {
        if (isMouseOutsideWindow) {
          // Screensaver Mode: Update position and handle bouncing
          cursorX += cursorVx;
          cursorY += cursorVy;

          const maxX = window.innerWidth - cursorSize;
          const maxY = window.innerHeight - cursorSize;
          let bounced = false;

          // Bounce off horizontal walls
          if (cursorX <= 0) {
            cursorX = 0; 
            cursorVx *= -1; 
            bounced = true;
          } else if (cursorX >= maxX) {
            cursorX = maxX; 
            cursorVx *= -1;
            bounced = true;
          }

          // Bounce off vertical walls
          if (cursorY <= 0) {
            cursorY = 0; 
            cursorVy *= -1; 
            bounced = true;
          } else if (cursorY >= maxY) {
            cursorY = maxY; 
            cursorVy *= -1;
            bounced = true;
          }

          customCursor.style.left = `${cursorX}px`;
          customCursor.style.top = `${cursorY}px`;

          if (bounced) {
              // Change color on bounce
              customCursor.style.backgroundColor = primaryColors[currentColorIndex % primaryColors.length];
              currentColorIndex++; 
              
              // Apply damping to velocity after bounce
              cursorVx *= screensaverDamping;
              cursorVy *= screensaverDamping;

              // Ensure a minimum speed to prevent stopping entirely
              const currentSpeed = Math.sqrt(cursorVx * cursorVx + cursorVy * cursorVy);
              const minSpeedAfterBounce = 1; // Minimum speed after damping
              if (currentSpeed < minSpeedAfterBounce) {
                  // If speed falls below minimum, reset to a small random speed
                  const angle = Math.random() * Math.PI * 2;
                  cursorVx = Math.cos(angle) * minSpeedAfterBounce;
                  cursorVy = Math.sin(angle) * minSpeedAfterBounce;
              }

              console.log(`Screensaver: BOUNCE! New Vx: ${cursorVx.toFixed(1)}, Vy: ${cursorVy.toFixed(1)}. Pos: (${cursorX.toFixed(1)}, ${cursorY.toFixed(1)})`);
          }

        } else {
          // Mouse/Touch-Following Mode: Cursor position is already updated by events, just apply it
          customCursor.style.left = `${cursorX}px`;
          customCursor.style.top = `${cursorY}px`;
        }
        
        animationId = requestAnimationFrame(mainAnimationLoop);
      }

      // --- Custom Cursor Positioning Logic (Updates internal X/Y and velocity based on mouse/touch) ---
      function handleMove(e) {
        startInactivityTimer(); // Reset inactivity timer on any movement
        if (!isMouseOutsideWindow) { // Only update if not in screensaver mode
          const clientX = e.clientX !== undefined ? e.clientX : (e.touches && e.touches[0] ? e.touches[0].clientX : lastClientX);
          const clientY = e.clientY !== undefined ? e.clientY : (e.touches && e.touches[0] ? e.touches[0].clientY : lastClientY);

          // Calculate instantaneous velocity
          cursorVx = clientX - lastClientX;
          cursorVy = clientY - lastClientY;

          // Update cursor position
          cursorX = clientX - (cursorSize / 2);
          cursorY = clientY - (cursorSize / 2);
          
          // Store current position for next velocity calculation
          lastClientX = clientX; 
          lastClientY = clientY; 
        }
      }

      // --- Scroll "Budging" Effect Logic ---
      const h1 = document.querySelector('h1'); 
      let initialTouchY = 0; // For tracking vertical swipe distance

      function handleWheel(e) {
        e.preventDefault(); 
        startInactivityTimer(); // Reset inactivity timer on scroll
        
        targetScrollOffset += -e.deltaY * scrollSensitivity;
        targetScrollOffset = Math.max(-scrollAmplitude, Math.min(scrollAmplitude, targetScrollOffset));

        if (!rAFScroll) { // Only start a new animation frame if one isn't already running
          rAFScroll = requestAnimationFrame(animateScrollEffect);
        }
      }

      function handleTouchStart(e) {
        initialTouchY = e.touches[0].clientY;
        startInactivityTimer(); // Reset inactivity timer on touch start
      }

      function handleTouchMove(e) {
        e.preventDefault(); // Prevent native scrolling to allow custom budging effect
        startInactivityTimer(); // Reset inactivity timer on touch move

        const touchDeltaY = e.touches[0].clientY - initialTouchY;
        targetScrollOffset += touchDeltaY * scrollSensitivity;
        targetScrollOffset = Math.max(-scrollAmplitude, Math.min(scrollAmplitude, targetScrollOffset));
        
        initialTouchY = e.touches[0].clientY; // Update for next move calculation

        if (!rAFScroll) {
          rAFScroll = requestAnimationFrame(animateScrollEffect);
        }

        // Also update cursor position based on touch
        handleMove(e);
      }

      function handleTouchEnd(e) {
        startInactivityTimer(); // Reset inactivity timer on touch end
        // No explicit cursor movement needed here as it stops when touch ends
      }


      function animateScrollEffect() {
        const delta = targetScrollOffset - scrollOffset;
        scrollOffset += delta * scrollSpring;

        // Apply damping to targetScrollOffset to bring it back to zero
        targetScrollOffset *= (1 - scrollDamping);

        // Stop animation if values are very close to zero
        if (Math.abs(delta) < 0.1 && Math.abs(targetScrollOffset) < 0.1) {
          scrollOffset = 0; 
          targetScrollOffset = 0;
          if (h1) { 
            h1.style.transform = `none`; // Reset transform once animation is complete
          }
          rAFScroll = null; // Clear the animation frame ID
          return;
        }

        if (h1) { 
          h1.style.transform = `translateY(${scrollOffset}px)`;
        }
        
        rAFScroll = requestAnimationFrame(animateScrollEffect);
      }
      
      // --- Custom Cursor Link Hover Color & Opacity Logic ---
      function initializeCursorLinkHover() {
        const allLinks = document.querySelectorAll('a'); 

        allLinks.forEach(link => {
          link.addEventListener('mouseenter', () => {
            const newColor = primaryColors[currentColorIndex % primaryColors.length];
            customCursor.style.backgroundColor = newColor;
            customCursor.style.opacity = '1'; 
            document.documentElement.style.setProperty('--current-link-hover-color', newColor); // Set CSS variable on root
            currentColorIndex++; 
          });

          link.addEventListener('mouseleave', () => {
            if (!isMouseOutsideWindow) { // Only revert to default if not in screensaver mode
              customCursor.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
              customCursor.style.opacity = '0.5'; 
              document.documentElement.style.setProperty('--current-link-hover-color', 'var(--link-hover-color-default)'); // Reset to default
            }
          });

          // Add touch equivalents for hover effect
          link.addEventListener('touchstart', () => {
              const newColor = primaryColors[currentColorIndex % primaryColors.length];
              customCursor.style.backgroundColor = newColor;
              customCursor.style.opacity = '1'; 
              document.documentElement.style.setProperty('--current-link-hover-color', newColor); // Set CSS variable on root
              currentColorIndex++; 
          });

          link.addEventListener('touchend', () => {
              if (!isMouseOutsideWindow) {
                  customCursor.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                  customCursor.style.opacity = '0.5'; 
                  document.documentElement.style.setProperty('--current-link-hover-color', 'var(--link-hover-color-default)'); // Reset to default
              }
          });
        });
      }

      // --- Initialization on DOM Ready ---
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupListeners);
      } else {
        setupListeners();
      }

      function setupListeners() {
        cursorSize = customCursor.offsetWidth; 

        // Mouse events
        document.addEventListener('mousemove', handleMove, { passive: true }); 
        window.addEventListener('wheel', handleWheel, { passive: false }); 
        
        // Touch events
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });

        initializeCursorLinkHover(); 
        
        // Primary triggers for screensaver activation/deactivation
        document.body.addEventListener('mouseleave', activateScreensaver);
        document.body.addEventListener('mouseenter', clearInactivityTimer); // Use clearInactivityTimer for re-entry

        // Robust fallbacks for window blur/focus (e.g., tab switching, minimizing)
        window.addEventListener('blur', activateScreensaver);
        window.addEventListener('focus', clearInactivityTimer);

        // Start inactivity timer on initial load
        startInactivityTimer();

        // Initialize lastClientX/Y to current cursor position, adjusted for centering
        // This ensures the velocity calculation is accurate from the very start
        const initialRect = customCursor.getBoundingClientRect();
        lastClientX = initialRect.left + (cursorSize / 2);
        lastClientY = initialRect.top + (cursorSize / 2);

        // Start the main animation loop immediately
        animationId = requestAnimationFrame(mainAnimationLoop);
      }
    })();
  </script>
</body>
</html>
